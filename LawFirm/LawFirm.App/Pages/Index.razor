@page "/"

@inject IClientDataService ClientDataService
@inject IEventDataService EventDataService

<PageTitle>Inicio - LawFirm</PageTitle>

<div class="container-fluid">
    @if (clients is null)
    {
        <p>Loading...</p>
    }
    else
    {
        <div class="row">
            <div class="col-md-4">
                <div class="alert alert-secondary" style="font-size: 13px;">
                    <span class="bi bi-people-fill" aria-hidden="true"></span>
                    <strong>&nbsp;Latests Clients</strong>
                </div>
                <div class="responsive-table">
                    <TableView Items="clients" Context="client">
                        <HeaderTemplate>
                            <th>Client Type</th>
                            <th>Firt Name</th>
                            <th>Last Name</th>
                            <th>Nit</th>
                            <th>Business Name</th>
                            <th>Representative</th>
                        </HeaderTemplate>
                        <RowTemplate>
                            <td>@client.ClientType</td>
                            <td>@client.FirstName</td>
                            <td>@client.LastName</td>
                            <td>@client.Nit</td>
                            <td>@client.BusinessName</td>
                            <td>@client.Representative</td>
                        </RowTemplate>
                    </TableView>
                </div>
            </div>
            <div class="col-md-4">
                <div class="alert alert-secondary" style="font-size: 13px;">
                    <span class="bi bi-app-indicator" aria-hidden="true"></span>
                    <strong>&nbsp;Today's Events</strong>
                </div>
                <div>
                    <SfSchedule TValue="EventVm" Height="100%" EnableAutoRowHeight="true" @bind-SelectedDate="@currentDate" AllowDragAndDrop="false" AllowResizing="false" AllowMultiCellSelection="false" AllowMultiRowSelection="false" AllowInline="false">

                        <ScheduleEventSettings DataSource="events" AllowAdding="false" EnableTooltip="true">
                            <ScheduleField Id="Id">
                                <FieldSubject Name="Title"></FieldSubject>
                                <FieldLocation Name="Location"></FieldLocation>
                                <FieldDescription Name="Description"></FieldDescription>
                                <FieldStartTime Name="EventStartDate"></FieldStartTime>
                                <FieldEndTime Name="EventEndDate"></FieldEndTime>
                            </ScheduleField>
                        </ScheduleEventSettings>

                        <ScheduleViews>
                            <ScheduleView Option="View.Day"></ScheduleView>
                            @*<ScheduleView Option="View.Agenda"></ScheduleView>*@
                        </ScheduleViews>

                    </SfSchedule>
                </div>
            </div>
            <div class="col-md-4">
                <div class="alert alert-secondary" style="font-size: 13px;">
                    <span class="bi bi-app-indicator" aria-hidden="true"></span>
                    <strong>&nbsp;Latests Cases</strong>
                </div>
            </div>
        </div>
    }
</div>

@code {
    ICollection<ClientVm> clients;
    ICollection<EventVm> events;
    DateTime currentDate = DateTime.Now;

    protected override async Task OnInitializedAsync()
    {
        clients = await ClientDataService.LatestClients();
        events = await EventDataService.FindEventsByStartDate(DateTime.Now);
    }
}