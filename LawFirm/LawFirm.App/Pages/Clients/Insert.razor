@page "/client-insert"

@attribute [Authorize]

@inject NavigationManager Navigation
@inject IClientDataService ClientDataService
@inject IJSRuntime JsRuntime
@inject IStringLocalizer<Shared.Resources.Resource> localizer

<PageTitle>@localizer["Client"] - Law Firm</PageTitle>

<SimpleNavigation BasePageRef="client" BasePage="@localizer["Client"]" CurrentPage="@localizer["AddClient"]" />

<EditForm Model="client" OnValidSubmit="HandleValidSubmit">

    <FluentValidationValidator />

    <ClientForm Client="client" />

    <div class="mt-4 mb-2">
        <div class="row">
            <div class="offset-4 col-8 text-end">
                <button class="btn btn-primary" type="submit">@localizer["Submit"]</button>
                <button class="btn btn-outline-secondary" type="button" @onclick="@(() => Navigation.NavigateTo("client"))">@localizer["Cancel"]</button>
            </div>
        </div>
    </div>

</EditForm>


@code {
    private ClientVm client = new();

    private async Task HandleValidSubmit()
    {
        try
        {
            var clientCreated = await ClientDataService.CreateClient(client);

            if (clientCreated is not null)
            {
                await JsRuntime.InvokeVoidAsync("showSuccessToastr", localizer["ClientAddedConfirmation"].ToString());
                client = new();
            }
        }
        catch (ApiException)
        {
            await JsRuntime.InvokeVoidAsync("showErrorToastr", localizer["GenericError"].ToString());
        }

        await JsRuntime.InvokeVoidAsync("scrollUtils.scrollToTop");
    }
}
